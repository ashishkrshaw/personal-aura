<div class="max-w-4xl mx-auto">
  <h2 class="text-2xl font-bold text-purple-500 dark:text-purple-300 mb-4">Navigation Helper</h2>
  
  <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg shadow-lg">
    @if (mapProvider() === 'none') {
      <div class="mb-4 bg-yellow-100 dark:bg-yellow-900/50 border border-yellow-300 dark:border-yellow-700 text-yellow-800 dark:text-yellow-300 p-4 rounded-lg">
        <p class="font-bold"><i class="fas fa-exclamation-triangle mr-2"></i>Map Visualization Unavailable</p>
        <p class="text-sm mt-1">To enable maps, please provide a valid API key for either Google Maps or Mappls in the <code class="bg-gray-200 dark:bg-gray-700 px-1 rounded">index.html</code> file. Google Maps is preferred; Mappls will be used as a fallback.</p>
      </div>
    }

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label for="source-location" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-1">From (Source)</label>
        <div class="relative">
          <input id="source-location" [(ngModel)]="sourceLocation" type="text" placeholder="e.g., Ghorthamba or click icon" class="w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-white p-3 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-purple-500 focus:border-purple-500 pr-10">
          <button (click)="getCurrentLocation('source')" [disabled]="isGettingLocation()" title="Get my current location" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-purple-500 dark:hover:text-purple-400 disabled:text-gray-500 dark:disabled:text-gray-600 disabled:cursor-wait">
              @if(isGettingLocation()) {
                  <i class="fas fa-spinner fa-spin"></i>
              } @else {
                  <i class="fas fa-crosshairs"></i>
              }
          </button>
        </div>
      </div>
      <div>
        <label for="destination-location" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-1">To (Destination)</label>
        <div class="relative">
          <input id="destination-location" [(ngModel)]="destinationLocation" type="text" placeholder="e.g., Baddiha or click icon" class="w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-white p-3 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-purple-500 focus:border-purple-500 pr-10">
          <button (click)="getCurrentLocation('destination')" [disabled]="isGettingLocation()" title="Get my current location" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-purple-500 dark:hover:text-purple-400 disabled:text-gray-500 dark:disabled:text-gray-600 disabled:cursor-wait">
              @if(isGettingLocation()) {
                  <i class="fas fa-spinner fa-spin"></i>
              } @else {
                  <i class="fas fa-crosshairs"></i>
              }
          </button>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
      <div>
        <label class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Travel Mode</label>
        <div class="flex flex-wrap gap-2">
          @for(mode of travelModes; track mode.id) {
            <button (click)="travelMode.set(mode.id)" [class]="'px-4 py-2 rounded-lg transition-colors text-sm flex items-center gap-2 ' + (travelMode() === mode.id ? 'bg-purple-600 text-white' : 'bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300')">
              <i [class]="'fas ' + mode.icon"></i>
              <span>{{ mode.name }}</span>
            </button>
          }
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Response Style</label>
        <div class="flex bg-gray-200 dark:bg-gray-700 rounded-full p-1">
            <button (click)="responseStyle.set('Default')" [class]="'w-1/2 py-2 rounded-full text-sm font-semibold transition-all ' + (responseStyle() === 'Default' ? 'bg-purple-600 text-white shadow' : 'text-gray-700 dark:text-gray-300 hover:bg-white/50 dark:hover:bg-gray-600/50')">
                Default
            </button>
            <button (click)="responseStyle.set('Human')" [class]="'w-1/2 py-2 rounded-full text-sm font-semibold transition-all ' + (responseStyle() === 'Human' ? 'bg-purple-600 text-white shadow' : 'text-gray-700 dark:text-gray-300 hover:bg-white/50 dark:hover:bg-gray-600/50')">
                Human
            </button>
        </div>
      </div>
    </div>
    
    <button (click)="getDirections()" [disabled]="isLoading()" class="mt-6 w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center disabled:bg-purple-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed">
      @if (isLoading()) {
        <i class="fas fa-spinner fa-spin mr-2"></i>
        <span>Getting Directions...</span>
      } @else {
        <i class="fas fa-diamond-turn-right mr-2"></i>
        <span>Get Directions</span>
      }
    </button>
  </div>

  @if (error()) {
    <div class="mt-6 bg-red-100 dark:bg-red-900/50 border border-red-300 dark:border-red-700 text-red-800 dark:text-red-300 p-4 rounded-lg">
      <p>{{ error() }}</p>
    </div>
  }

  @if (directions()) {
    <div class="mt-6 bg-gray-50 dark:bg-gray-800 p-6 rounded-lg shadow-lg animate-fade-in">
      @if(mapProvider() !== 'none') {
        <div class="border-b border-gray-200 dark:border-gray-700 pb-4 mb-4">
          <h4 class="text-lg font-semibold text-purple-600 dark:text-purple-400 mb-2 capitalize">Map Visualization ({{ mapProvider() }})</h4>
          <div #mapContainer class="w-full h-96 rounded-lg bg-gray-200 dark:bg-gray-900 border border-gray-300 dark:border-gray-700"></div>
          <p class="text-center text-xs text-gray-400 dark:text-gray-500 mt-1">Map data &copy; {{ mapProvider() === 'google' ? 'Google' : 'Mappls' }}</p>
        </div>
      }

      @if(directions()?.isHuman) {
         <div class="prose prose-invert max-w-none prose-p:text-gray-600 dark:prose-p:text-gray-300 prose-h3:text-purple-600 dark:prose-h3:text-purple-300">
            <h3>{{ directions()?.summary }}</h3>
            <p class="whitespace-pre-wrap leading-relaxed">{{ directions()?.steps[0] }}</p>
         </div>
      } @else {
        <h3 class="text-xl font-semibold text-purple-600 dark:text-purple-300 mb-3">{{ directions()?.summary }}</h3>
        <ul class="space-y-3">
          @for (step of directions()?.steps; track $index) {
            <li class="flex items-start">
              <div class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold text-sm mr-3 flex-shrink-0">{{ $index + 1 }}</div>
              <p class="text-gray-700 dark:text-gray-300">{{ step.substring(step.indexOf('.') + 1).trim() }}</p>
            </li>
          }
        </ul>
      }
    </div>
  }
</div>