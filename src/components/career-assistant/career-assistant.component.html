<div class="max-w-4xl mx-auto">
  <h2 class="text-2xl font-bold text-purple-500 dark:text-purple-300 mb-4">Career Assistant</h2>

  <div class="flex border-b border-gray-200 dark:border-gray-700 mb-6">
    <button (click)="selectTab('search')" [class]="'px-4 py-2 font-semibold transition-colors ' + (activeTab() === 'search' ? 'border-b-2 border-purple-500 text-purple-600 dark:text-purple-400' : 'text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white')">
      <i class="fas fa-search mr-2"></i>Job Search
    </button>
    <button (click)="selectTab('roadmap')" [class]="'px-4 py-2 font-semibold transition-colors ' + (activeTab() === 'roadmap' ? 'border-b-2 border-purple-500 text-purple-600 dark:text-purple-400' : 'text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white')">
      <i class="fas fa-road mr-2"></i>Roadmap
    </button>
    <button (click)="selectTab('resume')" [class]="'px-4 py-2 font-semibold transition-colors ' + (activeTab() === 'resume' ? 'border-b-2 border-purple-500 text-purple-600 dark:text-purple-400' : 'text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white')">
      <i class="fas fa-file-alt mr-2"></i>Resume Review
    </button>
  </div>

  @if (activeTab() === 'search') {
    <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg shadow-lg">
      <h3 class="text-xl font-semibold mb-3">Find Your Next Role</h3>
      <div class="flex gap-2">
        <input [(ngModel)]="jobSearchQuery" (keyup.enter)="searchJobs()" type="text" placeholder="e.g., Angular Developer in London" class="flex-grow bg-white dark:bg-gray-700 text-gray-800 dark:text-white p-3 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-purple-500 focus:border-purple-500">
        <button (click)="searchJobs()" [disabled]="isSearchingJobs()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-md transition-colors flex items-center justify-center disabled:bg-purple-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed">
          @if (isSearchingJobs()) {
            <i class="fas fa-spinner fa-spin"></i>
          } @else {
            <i class="fas fa-search"></i>
          }
        </button>
      </div>
      @if (isSearchingJobs()) {
        <p class="text-center text-gray-500 dark:text-gray-400 mt-4">Searching for jobs...</p>
      }
      @if (jobSearchResults().length > 0) {
        <div class="mt-6 space-y-3">
          @for (job of jobSearchResults(); track job.url) {
            <a [href]="job.url" target="_blank" class="block bg-white dark:bg-gray-700 p-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600/50 border border-gray-200 dark:border-gray-600 transition-colors">
              <p class="font-semibold text-purple-600 dark:text-purple-300">{{ job.title }}</p>
              <p class="text-sm text-gray-500 dark:text-gray-400 truncate">{{ job.url }}</p>
            </a>
          }
        </div>
      }
    </div>
  }

  @if (activeTab() === 'roadmap') {
     <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg shadow-lg">
      <h3 class="text-xl font-semibold mb-3">Generate a Career Roadmap</h3>
       <div class="flex gap-2">
        <input [(ngModel)]="roadmapRole" (keyup.enter)="generateRoadmap()" type="text" placeholder="e.g., Senior Frontend Engineer" class="flex-grow bg-white dark:bg-gray-700 text-gray-800 dark:text-white p-3 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-purple-500 focus:border-purple-500">
        <button (click)="generateRoadmap()" [disabled]="isGeneratingRoadmap()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-md transition-colors flex items-center justify-center disabled:bg-purple-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed">
          @if (isGeneratingRoadmap()) {
            <i class="fas fa-spinner fa-spin"></i>
          } @else {
             <span>Generate</span>
          }
        </button>
      </div>
      @if (isGeneratingRoadmap()) {
         <p class="text-center text-gray-500 dark:text-gray-400 mt-4">Building your roadmap with deep thinking...</p>
      }
      @if (generatedRoadmap()) {
        <div class="mt-6 p-4 bg-gray-100 dark:bg-gray-900/50 rounded-lg prose prose-invert max-w-none prose-pre:bg-gray-200 dark:prose-pre:bg-gray-700 prose-p:text-gray-800 dark:prose-p:text-gray-200">
          <pre class="whitespace-pre-wrap font-sans text-gray-800 dark:text-gray-200">{{ generatedRoadmap() }}</pre>
        </div>
      }
    </div>
  }

  @if (activeTab() === 'resume') {
    <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg shadow-lg">
       <h3 class="text-xl font-semibold mb-3">Get Resume Feedback</h3>
       <textarea [(ngModel)]="resumeText" placeholder="Paste your resume text here, or upload a file..." class="w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-white p-3 rounded-md border border-gray-300 dark:border-gray-600 h-64 focus:ring-purple-500 focus:border-purple-500"></textarea>
       <div class="flex justify-between items-center mt-3">
          <label class="text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 cursor-pointer">
              <i class="fas fa-upload mr-1"></i> Upload .txt file
              <input type="file" class="hidden" (change)="handleResumeUpload($event)" accept=".txt">
          </label>
          <button (click)="reviewResume()" [disabled]="isReviewingResume()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center justify-center disabled:bg-purple-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed">
             @if (isReviewingResume()) {
                <i class="fas fa-spinner fa-spin mr-2"></i>
                <span>Analyzing...</span>
              } @else {
                 <span>Get Feedback</span>
              }
          </button>
       </div>
       @if (isReviewingResume()) {
         <p class="text-center text-gray-500 dark:text-gray-400 mt-4">Reviewing your resume...</p>
      }
      @if (resumeFeedback()) {
        <div class="mt-6 p-4 bg-gray-100 dark:bg-gray-900/50 rounded-lg prose prose-invert max-w-none prose-pre:bg-gray-200 dark:prose-pre:bg-gray-700 prose-p:text-gray-800 dark:prose-p:text-gray-200">
          <pre class="whitespace-pre-wrap font-sans text-gray-800 dark:text-gray-200">{{ resumeFeedback() }}</pre>
        </div>
      }
    </div>
  }
</div>